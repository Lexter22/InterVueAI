<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Interview Summary - IntervueAI</title>
  <link rel="stylesheet" href="/css/styles.css" />
  <style>
    .loading { text-align: center; padding: 40px; }
    .result-pass { color: #28a745; font-weight: bold; }
    .result-fail { color: #dc3545; font-weight: bold; }
    .score-passed { color: #28a745; font-weight: bold; }
    .score-failed { color: #dc3545; font-weight: bold; }
    .position-info { margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; }
    .position-info p { margin: 5px 0; font-size: 16px; }
    .improvement-section { margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107; }
  </style>
</head>
<body>
  <header class="nav">
    <div class="nav-inner">
      <div class="nav-left">
        <div class="logo-badge">A</div>
        <div>
          <div class="nav-title">IntervueAI</div>
          <div class="nav-sub">AI Interview Summary</div>
        </div>
      </div>
    </div>
  </header>

  <main class="shell summary-shell">
    <div class="card summary-card">
      <h1 class="summary-title">Interview Summary</h1>
      
      <div id="loadingState" class="loading">
        <p>Loading your interview results...</p>
      </div>

      <div id="resultsContent" style="display: none;">
        <div class="position-info">
          <p><strong>Position:</strong> <span id="positionName">-</span></p>
          <p><strong>Overall Score:</strong> <span id="overallScore">-</span>%</p>
        </div>

        <div class="scorecard-grid" id="scorecardGrid"></div>

        <div class="card feedback-card">
          <h3 class="feedback-title">AI Feedback</h3>
          <p class="feedback-text" id="aiFeedback">-</p>
        </div>

        <div id="improvementSection" class="improvement-section" style="display: none;">
          <h3>Areas for Improvement</h3>
          <p id="improvementTips">-</p>
        </div>

        <div class="verdict-card">
          <h2 class="verdict-title">Final Result: <strong id="finalResult">-</strong></h2>
          <p class="verdict-subtitle" id="recommendation">-</p>
        </div>

        <div class="summary-actions">
          <a href="/" class="btn btn-ghost summary-btn">Return to Home</a>
        </div>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(loadResults, 1000); // Brief delay for loading effect
    });

    function loadResults() {
      const results = JSON.parse(localStorage.getItem('interviewResults') || '{}');
      
      if (Object.keys(results).length === 0) {
        displayFallback();
        return;
      }
      
      displayResults(results);
    }

    function displayResults(results) {
      document.getElementById('loadingState').style.display = 'none';
      document.getElementById('resultsContent').style.display = 'block';
      
      // Basic info
      document.getElementById('positionName').textContent = results.position || 'Unknown Position';
      document.getElementById('overallScore').textContent = results.overall_score || 0;
      
      // Category scores
      const grid = document.getElementById('scorecardGrid');
      grid.innerHTML = '';
      
      if (results.category_scores && results.category_scores.length > 0) {
        for (let i = 0; i < results.category_scores.length; i += 2) {
          const card = document.createElement('div');
          card.className = 'card scorecard-item';
          
          const cat1 = results.category_scores[i];
          const cat2 = results.category_scores[i + 1];
          
          card.innerHTML = `
            <p><strong>${cat1.category}:</strong> <span class="score-${cat1.status.toLowerCase()}">${cat1.status}</span></p>
            ${cat2 ? `<p><strong>${cat2.category}:</strong> <span class="score-${cat2.status.toLowerCase()}">${cat2.status}</span></p>` : ''}
          `;
          
          grid.appendChild(card);
        }
      }
      
      // AI feedback
      document.getElementById('aiFeedback').textContent = results.ai_feedback || 'No feedback available.';
      
      // Improvement tips (show only if failed)
      if (results.overall_result === 'FAIL' && results.improvement_tips) {
        document.getElementById('improvementSection').style.display = 'block';
        document.getElementById('improvementTips').textContent = results.improvement_tips;
      }
      
      // Final result
      const resultElement = document.getElementById('finalResult');
      const recommendationElement = document.getElementById('recommendation');
      
      if (results.overall_result === 'PASS') {
        resultElement.textContent = 'PASSED';
        resultElement.className = 'result-pass';
        recommendationElement.textContent = 'Congratulations! You have been recommended for the next round.';
      } else {
        resultElement.textContent = 'NEEDS IMPROVEMENT';
        resultElement.className = 'result-fail';
        recommendationElement.textContent = 'Please review the feedback and consider reapplying after addressing the areas for improvement.';
      }
    }

    function displayFallback() {
      document.getElementById('loadingState').style.display = 'none';
      document.getElementById('resultsContent').style.display = 'block';
      
      // Show generic message
      document.getElementById('positionName').textContent = 'Interview Completed';
      document.getElementById('overallScore').textContent = '0';
      document.getElementById('aiFeedback').textContent = 'Interview results are being processed. Please check back later.';
      document.getElementById('finalResult').textContent = 'PROCESSING';
      document.getElementById('recommendation').textContent = 'Your results will be available shortly.';
    }
  </script>
</body>
</html>